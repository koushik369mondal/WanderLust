<!-- Premium Tailwind Theme Toggle - Simple Button Design -->
<div class="tw-flex-shrink-0">
  <button type="button" id="theme-toggle-btn"
    class="tw-inline-flex tw-items-center tw-justify-center tw-h-11 tw-w-11 tw-bg-white/10 tw-backdrop-blur-md tw-border tw-border-white/20 tw-rounded-xl tw-text-white hover:tw-bg-white/20 hover:tw-scale-105 tw-transition-all tw-duration-300 tw-cursor-pointer tw-relative focus-visible:tw-ring-2 focus-visible:tw-ring-aqua focus-visible:tw-ring-offset-2 focus-visible:tw-ring-offset-brand1"
    aria-label="Toggle dark mode" role="switch" aria-checked="false">
    <!-- Sun Icon (Light Mode) -->
    <i class="fa-solid fa-sun tw-text-base tw-transition-all tw-duration-300" id="theme-icon-light"
      aria-hidden="true"></i>
    <!-- Moon Icon (Dark Mode) - Hidden by default -->
    <i class="fa-solid fa-moon tw-text-base tw-transition-all tw-duration-300 tw-hidden" id="theme-icon-dark"
      aria-hidden="true"></i>
  </button>
</div>

<script>
  // Lightweight Theme Manager with Tailwind
  (function () {
    'use strict';

    const STORAGE_KEY = 'wanderlust-theme-preference';
    const btn = document.getElementById('theme-toggle-btn');
    const iconLight = document.getElementById('theme-icon-light');
    const iconDark = document.getElementById('theme-icon-dark');

    // Initialize theme
    function getInitialTheme() {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) return stored;
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }

    let currentTheme = getInitialTheme();

    function applyTheme(theme) {
      if (theme === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
        document.body.classList.add('dark-mode');
        iconLight.classList.add('tw-hidden');
        iconDark.classList.remove('tw-hidden');
        btn.setAttribute('aria-checked', 'true');
        btn.setAttribute('aria-label', 'Switch to light mode');
      } else {
        document.documentElement.removeAttribute('data-theme');
        document.body.classList.remove('dark-mode');
        iconLight.classList.remove('tw-hidden');
        iconDark.classList.add('tw-hidden');
        btn.setAttribute('aria-checked', 'false');
        btn.setAttribute('aria-label', 'Switch to dark mode');
      }

      // Update meta theme-color
      let metaTheme = document.querySelector('meta[name="theme-color"]');
      if (!metaTheme) {
        metaTheme = document.createElement('meta');
        metaTheme.name = 'theme-color';
        document.head.appendChild(metaTheme);
      }
      metaTheme.content = theme === 'dark' ? '#1f2937' : '#ffffff';

      // Dispatch event for other components
      window.dispatchEvent(new CustomEvent('themeChanged', { detail: { theme } }));
    }

    function toggleTheme() {
      currentTheme = currentTheme === 'light' ? 'dark' : 'light';
      localStorage.setItem(STORAGE_KEY, currentTheme);
      applyTheme(currentTheme);
    }

    // Apply initial theme
    applyTheme(currentTheme);

    // Event listeners
    if (btn) {
      btn.addEventListener('click', toggleTheme);
    }

    // Keyboard shortcut (Ctrl + Shift + T)
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.shiftKey && e.key === 'T') {
        e.preventDefault();
        toggleTheme();
      }
    });

    // System preference change detection
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      if (!localStorage.getItem(STORAGE_KEY)) {
        currentTheme = e.matches ? 'dark' : 'light';
        applyTheme(currentTheme);
      }
    });

    // Cross-tab sync
    window.addEventListener('storage', (e) => {
      if (e.key === STORAGE_KEY && e.newValue) {
        currentTheme = e.newValue;
        applyTheme(currentTheme);
      }
    });

    // Expose globally for debugging
    window.themeManager = {
      getTheme: () => currentTheme,
      setTheme: (theme) => {
        if (['light', 'dark'].includes(theme)) {
          currentTheme = theme;
          localStorage.setItem(STORAGE_KEY, theme);
          applyTheme(theme);
        }
      },
      resetToSystem: () => {
        localStorage.removeItem(STORAGE_KEY);
        currentTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        applyTheme(currentTheme);
      }
    };
  })();
</script>