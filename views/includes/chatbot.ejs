<!-- Travel Chatbot -->
<div id="chatbot-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
  <button id="chatbot-toggle" class="btn btn-primary rounded-circle" style="width: 60px; height: 60px;">
    <i class="fa-solid fa-comments"></i>
  </button>
  
  <div id="chatbot-window" class="card" style="width: 350px; height: 400px; display: none; position: absolute; bottom: 70px; right: 0;">
    <div class="card-header bg-primary text-white">
      <h6 class="mb-0"><i class="fa-solid fa-robot me-2"></i>Travel Guide Bot</h6>
    </div>
    <div class="card-body p-0">
      <div id="chat-messages" style="height: 300px; overflow-y: auto; padding: 15px;">
        <div class="bot-message mb-2">
          <small class="text-muted">Bot</small>
          <div class="bg-light p-2 rounded">
            Hi! I'm your travel guide. Ask me about destinations, best places to visit, activities, seasons, transport, accommodation, budget tips, and more!
          </div>
        </div>
      </div>
      <div class="border-top p-2">
        <div class="input-group">
          <input type="text" id="chat-input" class="form-control" placeholder="Ask me anything...">
          <button id="send-btn" class="btn btn-primary">
            <i class="fa-solid fa-paper-plane"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const toggle = document.getElementById('chatbot-toggle');
  const window = document.getElementById('chatbot-window');
  const input = document.getElementById('chat-input');
  const sendBtn = document.getElementById('send-btn');
  const messages = document.getElementById('chat-messages');

  toggle.addEventListener('click', () => {
    window.style.display = window.style.display === 'none' ? 'block' : 'none';
  });

  function addMessage(message, isUser = false) {
    const div = document.createElement('div');
    div.className = `${isUser ? 'user' : 'bot'}-message mb-2`;
    div.innerHTML = `
      <small class="text-muted">${isUser ? 'You' : 'Bot'}</small>
      <div class="${isUser ? 'bg-primary text-white ms-auto' : 'bg-light'} p-2 rounded" style="${isUser ? 'max-width: 80%;' : ''}">
        ${message}
      </div>
    `;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  function sendMessage() {
    const message = input.value.trim();
    if (!message) return;

    addMessage(message, true);
    input.value = '';

    fetch('/chatbot/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message })
    })
    .then(res => res.json())
    .then(data => addMessage(data.response))
    .catch(() => addMessage('Sorry, I encountered an error. Please try again.'));
  }

  sendBtn.addEventListener('click', sendMessage);
  input.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendMessage();
  });
});
</script>